<!DOCTYPE html>
<html lang="en">
<head>
    <title>SEC - Saga Execution Coordinator - StackSAGA</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Introduction to stacksaga">
    <meta name="author" content="Mafei">


    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="./../../../assets/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./../../../assets/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./../../../assets/fav/favicon-16x16.png">
    <link rel="manifest" href="./../../../assets/fav/site.webmanifest">
    <link rel="mask-icon" href="./../../../assets/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="apple-mobile-web-app-title" content="stacksaga">
    <meta name="application-name" content="stacksaga">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#28b76b">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet">

    <!-- FontAwesome JS-->
    <script defer src="../../../assets/fontawesome/js/all.min.js"></script>

    <!-- Plugins CSS -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.2/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../../assets/plugins/simplelightbox/simple-lightbox.min.css">

    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="../../../assets/css/theme.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LC0M1Q19EK"></script>
    <link rel="stylesheet" href="../../../assets/css/custom.css">

    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-LC0M1Q19EK');
    </script>

</head>
<body class="docs-page">
<header class="header fixed-top">
    <div class="branding docs-branding">
        <div class="container-fluid position-relative py-2">
            <div class="docs-logo-wrapper">
                <button id="docs-sidebar-toggler" class="docs-sidebar-toggler docs-sidebar-visible me-2 d-xl-none"
                        type="button">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>

                <div class="site-logo">
                    <a class="navbar-brand" href="../../../index.html">
                        <img width="8%" height="8%" src="../../../assets/images/stack-saga-icon.svg"
                             alt="logo" class="img-fluid"/>
                        <span class="logo-text">Stack<span class="text-alt">SAGA</span></span>
                    </a>
                </div>


            </div><!--//docs-logo-wrapper-->

            <div class="docs-top-utilities d-flex justify-content-end align-items-center">
                <div class="top-search-box d-none d-lg-flex">
                    <form class="search-form">
                        <input type="text" placeholder="Search the docs..." name="search"
                               class="form-control search-input">
                        <button type="submit" class="btn search-btn" value="Search"><i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>

                <ul class="social-list list-inline mx-md-3 mx-lg-5 mb-0 d-none d-lg-flex">
                    <li class="list-inline-item"><a href="https://github.com/stacksaga"><i
                            class="fab fa-github fa-fw"></i></a></li>
                    <li class="list-inline-item"><a href="https://stackoverflow.com/questions/tagged/stacksaga"><i
                            class="fab fa-stack-overflow fa-fw"></i></a></li>

                </ul><!--//social-list-->

            </div>
        </div><!--//container-->
    </div><!--//branding-->
</header><!--//header-->
<div>

    <div>
        <div class="container">
            <article class="docs-article" id="section-1">
                <header class="docs-header">
                    <h1 id="microservice-introduction" class="docs-heading">Saga execution coordinator (SEC)
                    </h1>
                    <section class="docs-intro">
                        <p>
                            The Saga Execution Coordinator (SEC) is the core component for implementing a successful
                            Saga flow. It maintains a Saga log that contains the sequence of events of a particular
                            flow. If a failure occurs within any of the components, the SEC queries the logs and helps
                            identify which components are impacted and in which sequence the compensating transactions
                            must be executed. Essentially, the SEC helps maintain an eventually consistent state of the
                            overall process.

                        </p>
                        <p>
                            If the SEC component itself fails, it can read the SEC logs when coming back up to identify
                            which of the components are successfully rolled back, identify which ones were pending, and
                            start calling them in reverse chronological order.
                        </p>

                        <ul>
                            <li>
                                Stores & interprets a Sagaâ€™s state machine
                            </li>
                            <li>
                                Executes the Requests of a Saga by talking to other services
                            </li>

                            <li>
                                Handles failure recovery by executing Compensating Requests
                            </li>


                        </ul>


                        <div>
                            <a target="_blank"
                               href="../../../assets/img/1.0/topics/stack-saga-e-store-example-SEC.drawio.svg"><img
                                    class="img-fluid"
                                    src="../../../assets/img/1.0/topics/stack-saga-e-store-example-SEC.drawio.svg"
                                    alt="Handler in StackSaga"
                                    title="Handler"/>
                            </a>
                        </div>
                        <br>
                        <br>
                        <h3>Hand-overing the initial process to SEC.</h3>
                        <p>here you can see an example code, how your process hand over to StackSaga SEC by using java
                            code in spring boot application. you have to autowire the <code>SagaTemplate</code> from the
                            StackSaga package by mentioning the Aggregator which is related to the transaction. it
                            contains one method that you can use.
                        </p>
                        <ul>
                            <li>
                                <code>void process(InitAggregator,StartExecutorClass);</code>
                                <ul>
                                    <li><b>InitAggregator</b> : the aggregator with initialed values</li>
                                    <li><b>StartExecutorClass</b> : the executor class which start the transaction.</li>
                                </ul>
                            </li>
                        </ul>
                        <script src="https://gist.github.com/mafei-dev/7248a0d0e74816f742c4bb20c34ffe60.js"></script>
                    </section>

                </header>

                <section id="event-store">
                    <h2>Event-store</h2>
                    <p>
                        Event-store is the location that StackSaga stores the data regarding the transaction execution
                        as well as the storing the metadata of the components that you provided like aggregator
                        details, executor details, application version details etc. all the data you can see through the
                        StackSaga dashboard. You can configure the database for event-store as the pattern of database
                        per service. Otherwise, you can provide one event-store for all services. But as a best
                        practice, event-store per service is recommended.
                        You can define separate a schema for event-store by providing the configurations.
                    </p>
                    <h5>How the data is stored in the event-store and how it will be used.</h5>
                    <p></p>

                    <h5>The requirement of the event-store</h5>
                    <p>
                        StackSaga framework provides the SEC capabilities. Then the framework have to store each the
                        execution data (aggregator state and the transaction information like that each sub
                        transaction was failed or success etc.) . The interesting part is how the framework saves
                        each state of the whole transaction process. As the initial step the transaction is saved in the
                        event store with initial data that you provided with the relevant aggregator. After the saving
                        the INIT step, the 1st executor is invoked and after invoking the executor the framework saves
                        the new updated aggregator state in the event store. Likewise, after each and every steps the
                        updated aggregator state and the execution state are saved in the event-store.
                    </p>

                    <h6>What is the reason of saving the states in the event-store?</h6>
                    <ul>
                        <li>
                            <b>To retry purpose.</b>
                            <p>
                                The main feature the framework provides is that any compensation transaction can be
                                re-invoke if there is any network issue. To do the re-invocation, the transaction data
                                should be saved as persistent.
                            </p>
                        </li>

                        <li>
                            <b>To see each and every step and their changes by using the StackSaga <a
                                    href="./stacksaga-admin-dashboard.html">Admin
                                Dashboard</a>.</b>
                            <p>
                                You can see how the aggregator was changed while each sub process of the transaction
                                which transactions was failed or which transaction is pending to the execution and which
                                transaction has been successfully done etc.
                            </p>
                        </li>


                    </ul>


                </section>
                <section id="dual-consistency-problem-of-sec">
                    <h2>
                        Dual-Consistency problem of SEC in microservice.
                    </h2>
                    <p>
                        In the microservice architecture we have concerned highly about the data consistency. As a
                        result of that, you have to move in to the Saga design pattern. But there is problem can be
                        happened in rare when using SEC. because the SEC also uses a database to store the state and
                        other stuff. Then the frame has the responsibility to keep the data consistency of the main
                        transaction's data and the storing data. Just think the process is being executed and while
                        after saving successfully some executors and the event-store database goes down. Then the
                        framework is failed to provide the data consistency of their side. In the stack saga framework,
                        to avoid this consistency issue, a solution is provided.
                    </p>
                    <p>
                        The solution the frame provides. As mentioned above, if the database goes down when executing an
                        executor and try to save the state in the event-store, the framework doesn't give up the
                        process due to the database error. Because, the framework has the responsibility keep the data
                        consistency anytime. Because the framework is also built to take care of the data consistency
                        then the framework can't forget their data consistency as well.
                    </p>
                    <p>
                        Then after trying to save the event-data in the event store, the SCE gets known the there is a
                        database connection loss. Then SCE convert the whole dataset (the dataset that tried to save in
                        the database) regarding the event to binary file in the application scope's file system (in
                        spring boot, it
                        can be the resource folder) to keep data in persist . The file is saved as temporary. After
                        saving the temporary file, the SEC transfers that file into the admin database through the Redis
                        server immediately. Because in the microservices' architecture, the server instance is not
                        persist. The reason is that the server instance are built automatically based on the load in the
                        individual containers. That's why the saved file immediately transfer to the admin database.
                        Then that file will be saved in the database as binary.
                    </p>

                    <p>
                        After saving the data file in to the admin database, the admin server tries to invoke by using
                        another randomly selected same microservice. The instance is not a problem here because one
                        service can have same multiple instances. Then one of same services can invoke that data file if
                        the database connection is successful. If there is no any instance instead of that the admin
                        server keep waiting for connection is successful. After connection is back to normal the admin
                        server will push the file in to one of services and invoke the file. After invoking the file
                        data successfully the particular service will push a message to the admin server to delete the
                        saved file. Because after invoking the file there is no point in saving that file in the admin
                        server. It should be deleted. Because if the file data is existing in the admin database, the
                        admin server try to invoke it again. That's how the framework handle its data consistency while
                        keep the client's data consistency as well. It is true that the possibility is very rare but
                        just think that if happen that issue the transaction processes will not be complete and the
                        transaction can't archive the eventual consistency as well. As a programmer I think this is the
                        main advantage of using StackSaga framework. Now if you have a doubt what happens if the admin
                        server is not up and running? It doesn't matter. If occurred that kind of situation and one of
                        services try to send a file into admin server while the admin server is down, the file is kept
                        by the relevant instance until the admin server up. When the admin server goes up the instance
                        will know about and then the instance will push the file into the admin server as usual. Now you
                        can have a problem in your mind. What happen if the admin server is down and the relevant
                        instance is also going to be down. Then what will happen to that saved file? The framework has
                        considered that as well. Normally the instances are down by stopping the application
                        server. Then the framework doesn't give a chance to stop the server until push that kind of
                        saved files are transferred. The server keep waiting until the admin server goes up.
                        Those files can be missing only you kill the application by forcing.
                    </p>

                    <img src="./../../../assets/img/1.0/topics/how-stacksaga-manage-data-consistency-internally.gif"
                         alt="Dual consistency problem of SEC in microservice StackSaga" class="img-fluid">
                </section>


                <section class="docs-section" id="item-1-4">
                    <h4>Explore the concepts behind stackSaga</h4>
                    <ul>
                        <li><a href="./../introduction.html">Introduction</a></li>
                        <li><a href="./../architecture.html">High-level Architecture</a></li>
                        <li><a href="./../how-works-stack-saga-transaction-types.html">How Stack Saga Execution Types
                            work</a>
                        </li>
                        <li><a href="../topics/SEC.html">Saga execution coordinator (SEC)</a></li>
                        <li><a href="../topics/SEC.html#dual-consistency-problem-of-sec">Dual-consistency problem of
                            SEC</a></li>

                        <li><a href="../topics/circuit-breaker.html">Real-time Circuit Breaker</a></li>
                        <li><a href="../topics/SEC.html#event-store">Event-Store</a></li>

                        <li><a target="_blank" href="../topics/aggregator.html">Aggregator</a></li>
                        <li><a target="_blank" href="../topics/executor.html">Executor</a></li>
                        <li><a target="_blank" href="../topics/handler.html">Handlers</a></li>
                        <li><a target="_blank" href="../topics/retryable-exception-vs-non-retryable-exception.html">Retryable
                            Exceptions</a></li>
                        <li><a href="../topics/hint-store.html">Hint store</a></li>
                        <li><a href="../topics/version-casting.html">Version Casting</a></li>
                        <li><a href="../topics/stacksaga-admin-dashboard.html">StackSaga Admin</a></li>
                    </ul>

                </section>


            </article>

        </div>
    </div>
</div>
<!-- Javascript -->
<script src="../../../assets/plugins/popper.min.js"></script>
<script src="../../../assets/plugins/bootstrap/js/bootstrap.min.js"></script>


<!-- Page Specific JS -->
<script src="../../../assets/plugins/smoothscroll.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
<script src="../../../assets/js/highlight-custom.js"></script>
<script src="../../../assets/plugins/simplelightbox/simple-lightbox.min.js"></script>
<script src="../../../assets/plugins/gumshoe/gumshoe.polyfills.min.js"></script>
<script src="../../../assets/js/docs.js"></script>
</body>
</html> 

