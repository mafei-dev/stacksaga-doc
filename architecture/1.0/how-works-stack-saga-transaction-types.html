<!DOCTYPE html>
<html lang="en">
<head>
    <title>How Saga Transaction types works - StackSaga</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Stack SAGA Quick Start with spring boot microservice.">
    <meta name="author" content="Mafei">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="./../../assets/fav/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./../../assets/fav/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./../../assets/fav/favicon-16x16.png">
    <link rel="manifest" href="./../../assets/fav/site.webmanifest">
    <link rel="mask-icon" href="./../../assets/fav/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="apple-mobile-web-app-title" content="stacksaga">
    <meta name="application-name" content="stacksaga">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#28b76b">


    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet">

    <!-- FontAwesome JS-->
    <script defer src="../../assets/fontawesome/js/all.min.js"></script>

    <!-- Plugins CSS -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.2/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="../../assets/plugins/simplelightbox/simple-lightbox.min.css">

    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="../../assets/css/theme.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LC0M1Q19EK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-LC0M1Q19EK');
    </script>

</head>
<body class="docs-page">
<header class="header fixed-top">
    <div class="branding docs-branding">
        <div class="container-fluid position-relative py-2">
            <div class="docs-logo-wrapper">
               <!-- <button id="docs-sidebar-toggler" class="docs-sidebar-toggler docs-sidebar-visible me-2 d-xl-none"
                        type="button">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>-->

                <div class="site-logo">
                    <a class="navbar-brand" href="../../index.html">
                        <img width="8%" height="8%" src="../../assets/images/stack-saga-icon.svg"
                             alt="logo"/>
                        <span class="logo-text">Stack<span class="text-alt">SAGA</span></span>
                    </a>
                </div>

            </div><!--//docs-logo-wrapper-->
            <div class="docs-top-utilities d-flex justify-content-end align-items-center">
                <div class="top-search-box d-none d-lg-flex">
                    <form class="search-form">
                        <input type="text" placeholder="Search the docs..." name="search"
                               class="form-control search-input">
                        <button type="submit" class="btn search-btn" value="Search"><i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>

                <ul class="social-list list-inline mx-md-3 mx-lg-5 mb-0 d-none d-lg-flex">
                    <li class="list-inline-item"><a href="https://github.com/stacksaga"><i
                            class="fab fa-github fa-fw"></i></a></li>
                    <li class="list-inline-item"><a href="https://stackoverflow.com/questions/tagged/stacksaga"><i
                            class="fab fa-stack-overflow fa-fw"></i></a></li>

                </ul><!--//social-list-->

            </div>

            <!--//docs-top-utilities-->
        </div><!--//container-->
    </div><!--//branding-->
</header><!--//header-->
<div class="docs-wrapper">
    <div id="docs-sidebar" class="docs-sidebar">
        <div class="top-search-box d-lg-none p-3">
            <form class="search-form">
                <input type="text" placeholder="Search the docs..." name="search" class="form-control search-input">
                <button type="submit" class="btn search-btn" value="Search"><i class="fas fa-search"></i></button>
            </form>
        </div>
        <nav id="docs-nav" class="docs-nav navbar">
            <ul class="section-items list-unstyled nav flex-column pb-3">
                <li class="nav-item section-title"><a class="nav-link scrollto active" href="#section-1"><span
                        class="theme-icon-holder me-2"><i class="fas fa-map-signs"></i></span>Transaction Types</a></li>
                <li class="nav-item"><a class="nav-link scrollto" href="#introduction">Introduction</a></li>
                <li class="nav-item"><a class="nav-link scrollto" href="#fully-success-transaction-scenario">Fully
                    success transaction
                    scenario</a></li>
                <li class="nav-item"><a class="nav-link scrollto" href="#revert-success-transaction-scenario">Revert
                    success transaction
                    scenario</a></li>
                <li class="nav-item"><a class="nav-link scrollto" href="#evert-failed-transaction-scenario">Revert
                    failed transaction
                    scenario</a></li>

            </ul>

        </nav><!--//docs-nav-->
    </div><!--//docs-sidebar-->

    <div class="docs-content">
        <div class="container">
            <article class="docs-article" id="section-1">
                <header class="docs-header">
                    <h1 id="introduction" class="docs-heading">Introduction
                    </h1>
                    <section class="docs-intro">
                        <p>In this section, you will get the architecture of this framework. other than that, you will
                            get
                            what are the limitations you have to face when you are going to use microservice
                            architecture
                            and how overcome those difficulties by using StackSAGA framework.</p>
                    </section><!--//docs-intro-->

                </header>


                <section>

                    <h2>How works StackSaga</h2>


                    <p>
                        First, the request comes to the controller layer, and you can create the <a
                            href="topics/aggregator.html">aggregator</a> object by
                        using the data initial data there which you got from the request. After creating the initial
                        aggregator object, you can send that aggregator object, and the transaction <a
                            href="topics/executor.html">start-executor</a> class
                        by using the SagaTemplate which you have auto-wired. After that, the (<a
                            href="topics/SEC.html" target="_blank">SEC</a>) will
                        take care of the request, and you will be updated with each and every step into the <a
                            target="_blank" href="topics/handler.html">handler</a> that
                        you provided regarding the aggregator of the transaction asynchronously.
                    </p>

                    <!--Fire And Forget start-->

                    <p>You know that in the saga flow, the transaction can be divided into <a target="_blank"
                                                                                              href="introduction.html#classification-of-transactions">3
                        types</a> according to
                        the behaviour of the transaction. let's see one by one how the StackSaga's execution-coordinator
                        coordinate
                        (<a href="topics/SEC.html" target="_blank">SEC</a>)
                        each component with each transaction types. </p>


                    <ul>
                        <li>
                            <a href="#fully-success-transaction-scenario">
                                Fully success transaction scenario
                            </a>
                        </li>
                        <li>
                            <a href="#revert-success-transaction-scenario">
                                Revert success transaction scenario
                            </a>
                        </li>
                        <li>
                            <a href="#evert-failed-transaction-scenario">
                                Rollback/Compensation/Revert failed transaction scenario
                            </a>
                        </li>
                    </ul>


                    <br>
                    <h3 id="fully-success-transaction-scenario">
                        Fully success transaction scenario
                    </h3>
                    <p>here, all the executors has been successfully executed by the SEC. therefore, there is no
                        compensation/revert execution was invoked. this is the success scenario we wish.</p>
                    <div>
                        <a target="_blank"
                           href="../../assets/images/architecture/1.0/Architecture-Stacksaga-fully-success-transaction-stacksaga.drawio.svg"><img
                                class="img-fluid  "
                                src="../../assets/images/architecture/1.0/Architecture-Stacksaga-fully-success-transaction-stacksaga.drawio.svg"
                                alt="Architecture Stacksaga fully success transaction stacksaga"
                                title="fully success transaction stacksaga"/></a>
                    </div>
                    <br>
                    <br>

                    <ul>
                        <li>
                            <span class="badge rounded-pill bg-number">1</span>
                            as the first step the user make the request and the <b>OrderController</b> catch the
                            request.
                        </li>

                        <li>
                            <span class="badge rounded-pill bg-number">2</span>
                            after having the request, initializes the place order aggregator and set the start executor
                            into the StackSaga. (In this time you have the transaction uid which created by framework.
                            The <b>transaction uid</b> is the unique id for identifying each transaction. You can get it
                            from
                            your created <b>Aggregator</b> object. )
                        </li>

                        <li>
                            <span class="badge rounded-pill bg-number">3</span>
                            now the execution processes is handled by the SEC. Before invoking the executor that you
                            provided as the <b>start-executor</b> SEC saves the initial state of the aggregator in the
                            <b>event-tore</b>.
                        </li>
                        <li>
                            <span class="badge rounded-pill bg-number">4</span>
                            SEC executes the start-executor<b> ([Command] CreateOrderExecutor)</b> that you provided.
                            <span class="badge rounded-pill bg-number">4.1</span>
                            due to the executing the process method
                            by the SEC, the <b>InternalOrderService's</b> <b>createOrder()</b> method will be invoked.
                            <span class="badge rounded-pill bg-number">4.2</span>
                            after successfully invoking the method, SEC will store the state of
                            the aggregator.
                            <span class="badge rounded-pill bg-number">4.3</span>
                            after saving the state in the
                            event-store, SEC will execute the <b>onEachProcessPerformed</b> method of the handler class
                            that you provided.
                            <span class="badge rounded-pill bg-number">4.4</span>
                            then you can put your execution here to update the status of the place-order transaction. as
                            the diagram, we have executed <b>updateCustomerOrderStatus()</b> method of <b>InternalOrderService</b>
                            to update the status.
                            <span class="badge rounded-pill bg-number">4.5</span>
                            after updating the status of the place-order, you can notify your customer by sending the
                            email or SMS or whatever method about the status of the order.
                        </li>

                        <li>
                            <p>
                                <span class="badge rounded-pill bg-number">5</span>
                                SEC executes the 2nd executor that you provided from the 1st executor.
                                <span class="badge rounded-pill bg-number">5.1</span>
                                due to the executing the <b>doProcess</b> method of the <b> [Query] UserExecutor</b>
                                by the SEC, the <b>ExternalUserStatusService's</b> <b>checkUser()</b> method will be
                                invoked.
                                <span class="badge rounded-pill bg-number">5.2</span>
                                the <b>ExternalUserStatusService</b> will call the <b>user-service</b> and make a
                                request.

                                <span class="badge rounded-pill bg-number">5.3</span>
                                after successfully invoking the request, SEC will store the state of
                                the aggregator of 2nd process.
                                <span class="badge rounded-pill bg-number">5.4</span>
                                after saving the state in the
                                event-store, SEC will execute the <b>onEachProcessPerformed</b> method of the handler
                                class
                                that you provided.
                            </p>
                            <p>
                                **Due to this executor is a query executor, there is no status update process have been
                                executed here.
                            </p>
                        </li>

                        <li>
                            <span class="badge rounded-pill bg-number">6</span>
                            SEC executes the <b>[Command] PaymentExecutor</b> executor that you provided.
                            <span class="badge rounded-pill bg-number">6.1</span>
                            due to the executing the process method
                            by the SEC, the <b>ExternalPaymentService's</b> <b>makePayment()</b> method will be invoked.
                            <span class="badge rounded-pill bg-number">6.2</span>
                            the <b>ExternalPaymentService</b> will call the <b>payment-service</b> and make a
                            request to make-payment process.
                            <span class="badge rounded-pill bg-number">6.3</span>
                            after successfully making the request, SEC will store the state of
                            the aggregator.
                            <span class="badge rounded-pill bg-number">6.4</span>
                            after saving the state in the
                            event-store, SEC will execute the <b>onEachProcessPerformed</b> method of the handler class
                            that you provided.
                            <span class="badge rounded-pill bg-number">6.5</span>
                            then you can put your execution here to update the status of the place-order transaction. as
                            the diagram, we have executed <b>updateCustomerOrderStatus()</b> method of <b>InternalOrderService</b>
                            to update the status.
                            <span class="badge rounded-pill bg-number">6.6</span>
                            after updating the status of the place-order, you can notify your customer by sending the
                            email or SMS or whatever method about the status of the order.
                        </li>

                        <li>
                            <span class="badge rounded-pill bg-number">7</span>
                            SEC executes the <b> [Command] DeliveryExecutor</b> that you provided.
                            <span class="badge rounded-pill bg-number">7.1</span>
                            due to the executing the process method
                            by the SEC, the <b>ExternalDeliveryService's</b> <b>addToDelivery()</b> method will be
                            invoked.
                            <span class="badge rounded-pill bg-number">7.2</span>
                            the <b>ExternalDeliveryService</b> will call the <b>delivery-service</b> and make a
                            request to add-to-delivery process.
                            <span class="badge rounded-pill bg-number">7.3</span>
                            after successfully making the request, SEC will store the state of
                            the aggregator.
                            <span class="badge rounded-pill bg-number">7.4</span>
                            after saving the state in the
                            event-store, SEC will execute the <b>onEachProcessPerformed</b> method of the handler class
                            that you provided.
                            <span class="badge rounded-pill bg-number">7.5</span>
                            then you can put your execution here to update the status of the place-order transaction. as
                            the diagram, we have executed <b>updateCustomerOrderStatus()</b> method of <b>InternalOrderService</b>
                            to update the status.
                            <span class="badge rounded-pill bg-number">7.6</span>
                            after updating the status of the place-order, you can notify your customer by sending the
                            email or SMS or whatever method about the status of the order.
                        </li>


                        <li>
                            <p>
                                <span class="badge rounded-pill bg-number">8</span>
                                as the final step the SEC will invoke the <b>onTransactionCompleted</b> method of the
                                handler.
                                <span class="badge rounded-pill bg-number">8.1</span>
                                you can update the place-order status as the final state as <b>success</b>.
                                <span class="badge rounded-pill bg-number">8.2</span>
                                after updating the place-order status you can notify it to the customer.
                            </p>
                        </li>
                    </ul>


                    <br>
                    <h3 id="revert-success-transaction-scenario">Compensation/Revert success transaction scenario</h3>
                    <p>here, all the executors hasn't been successfully executed by the SEC. an error occurred while
                        after some processing. therefore, the transaction has a compensation/revert executions.
                    </p>
                    <br>
                    <br>
                    <div>
                        <a target="_blank"
                           href="../../assets/images/architecture/1.0/Architecture-Stacksaga-revert-success-transaction-scenario.drawio.svg"><img
                                class="img-fluid  "
                                src="../../assets/images/architecture/1.0/Architecture-Stacksaga-revert-success-transaction-scenario.drawio.svg"
                                alt="Architecture Stacksaga revert success transaction scenario"
                                title="Revert success transaction scenario"/></a>
                    </div>
                    <br>
                    <br>

                    <ul>
                        <li>
                            <span class="badge rounded-pill bg-number">1</span>
                            as the first step the user make the request and the <b>OrderController</b> catch the
                            request.
                        </li>

                        <li>
                            <span class="badge rounded-pill bg-number">2</span>
                            after having the request, initializes the place order aggregator and set the start executor
                            into the StackSaga. (In this time you have the transaction uid which created by framework.
                            The <b>transaction uid</b> is the unique id for identifying each transaction. You can get it
                            from
                            your created <b>Aggregator</b> object. )
                        </li>

                        <li>
                            <span class="badge rounded-pill bg-number">3</span>
                            now the execution processes is handled by the SEC. Before invoking the executor that you
                            provided as the <b>start-executor</b> SEC saves the initial state of the aggregator in the
                            <b>event-tore</b>.
                        </li>
                        <li>
                            <span class="badge rounded-pill bg-number">4</span>
                            SEC executes the start-executor<b> ([Command] CreateOrderExecutor)</b> that you provided.
                            <span class="badge rounded-pill bg-number">4.1</span>
                            due to the executing the process method
                            by the SEC, the <b>InternalOrderService's</b> <b>createOrder()</b> method will be invoked.
                            <span class="badge rounded-pill bg-number">4.2</span>
                            after successfully invoking the method, SEC will store the state of
                            the aggregator.
                            <span class="badge rounded-pill bg-number">4.3</span>
                            after saving the state in the
                            event-store, SEC will execute the <b>onEachProcessPerformed</b> method of the handler class
                            that you provided.
                            <span class="badge rounded-pill bg-number">4.4</span>
                            then you can put your execution here to update the status of the place-order transaction. as
                            the diagram, we have executed <b>updateCustomerOrderStatus()</b> method of <b>InternalOrderService</b>
                            to update the status.
                            <span class="badge rounded-pill bg-number">4.5</span>
                            after updating the status of the place-order, you can notify your customer by sending the
                            email or SMS or whatever method about the status of the order.
                        </li>

                        <li>
                            <p>
                                <span class="badge rounded-pill bg-number">5</span>
                                SEC executes the 2nd executor that you provided from the 1st executor.
                                <span class="badge rounded-pill bg-number">5.1</span>
                                due to the executing the <b>doProcess</b> method of the <b> [Query] UserExecutor</b>
                                by the SEC, the <b>ExternalUserStatusService's</b> <b>checkUser()</b> method will be
                                invoked.
                                <span class="badge rounded-pill bg-number">5.2</span>
                                the <b>ExternalUserStatusService</b> will call the <b>user-service</b> and make a
                                request.

                                <span class="badge rounded-pill bg-number">5.3</span>
                                after successfully invoking the request, SEC will store the state of
                                the aggregator of 2nd process.
                                <span class="badge rounded-pill bg-number">5.4</span>
                                after saving the state in the
                                event-store, SEC will execute the <b>onEachProcessPerformed</b> method of the handler
                                class
                                that you provided.
                            </p>
                            <p>
                                **Due to this executor is a query executor, there is no status update process have been
                                executed here.
                            </p>
                        </li>

                        <li>
                            <span class="badge rounded-pill bg-number">6</span>
                            SEC executes the <b>[Command] PaymentExecutor</b> executor that you provided.
                            <span class="badge rounded-pill bg-number">6.1</span>
                            due to the executing the process method
                            by the SEC, the <b>ExternalPaymentService's</b> <b>makePayment()</b> method will be invoked.
                            <span class="badge rounded-pill bg-number">6.2</span>
                            the <b>ExternalPaymentService</b> will call the <b>payment-service</b> and make a
                            request to make-payment process. in this time <b>the request is failed</b> due to an
                            exception.
                        </li>

                        <li>
                            <p>
                                <span class="badge rounded-pill bg-number">7</span>
                                the SEC will invoke <b>onProcessException</b> method of the handler class that you
                                provided.
                                there you can get notified about the <b>process failure.</b> the transaction can't be
                                executed forward anymore,
                                the compensation process will start from this point.
                            </p>
                            <p>
                                **if you want to update the order status or update the customer, you can invoke your
                                code
                                here. in this example it hasn't been implemented.
                            </p>
                        </li>

                        <li>
                            <p>
                                <span class="badge rounded-pill bg-number">8</span>
                                due to the final successful executed is <b>OrderExecutor</b> (There is no compensation
                                because of the UserExecutor is a query executor.) SEC invoke the <b>doRevert</b> method
                                of
                                the <b>OrderExecutor</b>.
                                <span class="badge rounded-pill bg-number">8.1</span>
                                due to the executing of the <b>doRevert</b>
                                method, <b>createOrderRevert</b> method will be invoked and do the revert process of the
                                make-payment.
                                <span class="badge rounded-pill bg-number">8.2</span>
                                in the compensation process if you want to store some data regarding the revert process,
                                you
                                can store them into the
                                <a href="topics/hint-store.html" target="_blank">hint-store</a> the framework
                                provides.
                                that stored data is saved at this step.
                                <span class="badge rounded-pill bg-number">8.3</span>
                                after invoking successfully the revert, the SEC will invoke <b>onEachRevertPerformed</b>
                                method regarding the revert process.
                                <span class="badge rounded-pill bg-number">8.4</span>
                                the customer will be notified about the revert process. (if you want to update the order
                                status you can invoke your code here as well. that part hasn't been implemented in this
                                example.)
                            </p>
                        </li>

                        <li>
                            <p>
                                <span class="badge rounded-pill bg-number">9</span>
                                StackSaga state-machine knows that the compensation is done. therefore, SEC invoke the
                                <b>onTransactionCompleted</b> method as <b>REVERT_SUCCESS</b>.
                                <span class="badge rounded-pill bg-number">9.1</span>
                                you can update the status of the place-order regarding the revert was processed.
                                <span class="badge rounded-pill bg-number">9.2</span>
                                after that the customer will be notified about the revert success process of their
                                order.
                            </p>

                        </li>
                    </ul>


                    <div class="callout-block callout-block-info">

                        <div class="content">
                            <h4 class="callout-title">
	                                <span class="callout-icon-holder me-1">
		                                <i class="fas fa-info-circle"></i>
		                            </span><!--//icon-holder-->
                                Note
                            </h4>
                            <p>
                                to Keep the overall state of the transaction eventually consistent the revert processes
                                (compensation processes) can be retryable. because all the compensations must be
                                invoked. to
                                have a knowledge about how retry works of revert-processes in StackSaga, please refer <a
                                    href="topics/retryable-exception-vs-non-retryable-exception.html#how-retry-works-in-the-revert-process">this</a>.
                            </p>
                        </div>
                    </div>

                    <br>


                    <br>
                    <br>
                    <h5 id="evert-failed-transaction-scenario">Fire And Forget full process with
                        Rollback/Compensation/Revert failed transaction scenario</h5>
                    <div>
                        <a target="_blank"
                           href="../../assets/images/architecture/1.0/Architecture-Stacksaga-evert-failed-transaction-scenario.drawio.svg"><img
                                class="img-fluid"
                                src="../../assets/images/architecture/1.0/Architecture-Stacksaga-evert-failed-transaction-scenario.drawio.svg"
                                alt="Architecture Stacksaga revert failed transaction scenario"
                                title="Revert failed transaction scenario"/></a>
                    </div>

                </section>


                <section class="docs-section" id="item-1-4">
                    <h4>Explore the concepts behind stackSaga</h4>
                    <ul>
                        <li><a href="./introduction.html">Introduction</a></li>
                        <li><a href="./architecture.html">High-level Architecture</a></li>
                        <li><a href="./how-works-stack-saga-transaction-types.html">How Stack Saga Execution Types
                            work</a>
                        </li>
                        <li><a href="./topics/SEC.html">Saga execution coordinator (SEC)</a></li>
                        <li><a href="./topics/SEC.html#dual-consistency-problem-of-sec">Dual-consistency problem of
                            SEC</a></li>

                        <li><a href="./topics/circuit-breaker.html">Real-time Circuit Breaker</a></li>
                        <li><a href="./topics/SEC.html#event-store">Event-Store</a></li>

                        <li><a target="_blank" href="./topics/aggregator.html">Aggregator</a></li>
                        <li><a target="_blank" href="./topics/executor.html">Executor</a></li>
                        <li><a target="_blank" href="./topics/handler.html">Handlers</a></li>
                        <li><a target="_blank" href="./topics/retryable-exception-vs-non-retryable-exception.html">Retryable
                            Exceptions</a></li>
                        <li><a href="./topics/hint-store.html">Hint store</a></li>
                        <li><a href="./topics/stacksaga-admin-dashboard.html">StackSaga Admin</a></li>
                    </ul>

                </section>


            </article>

        </div>
    </div>
</div>
<!-- Javascript -->
<script src="../../assets/plugins/popper.min.js"></script>
<script src="../../assets/plugins/bootstrap/js/bootstrap.min.js"></script>


<!-- Page Specific JS -->
<script src="../../assets/plugins/smoothscroll.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
<script src="../../assets/js/highlight-custom.js"></script>
<script src="../../assets/plugins/simplelightbox/simple-lightbox.min.js"></script>
<script src="../../assets/plugins/gumshoe/gumshoe.polyfills.min.js"></script>
<script src="../../assets/js/docs.js"></script>
</body>
</html> 

